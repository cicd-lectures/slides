[{invert}]
= "Continuous Everything"

== Livraison Continue

Continuous Delivery (CD)

== ğŸ¤” Pourquoi la Livraison Continue ?

* Diminuer les risque liÃ©s au dÃ©ploiement
* Permettre de rÃ©colter des retours utilisateurs plus souvent
* Rendre l'avancement visible par *tous*

[quote, Mary and Tom Poppendieck]
____
How long would it take to your organization to deploy a change that
involves just one single line of code?
____

== Qu'est ce que la Livraison Continue ?

* Suite logique de l'intÃ©gration continue:
** Chaque changement est *potentiellement* dÃ©ployable en production
** Le dÃ©ploiement peut donc Ãªtre effectuÃ© Ã  *tout* moment

[quote, Martin Fowler]
____
Your team prioritizes keeping the software *deployable* over working on new features
____

[{invert}]
== !

La livraison continue est l'exercice de **mettre Ã  disposition automatiquement** le produit logiciel pour qu'il soit prÃªt Ã  Ãªtre dÃ©ployÃ© Ã  tout moment.

== Livraison Continue avec GitHub Actions

== PrÃ©requis: exÃ©cution conditionnelle des jobs

Il est possible dâ€™exÃ©cuter conditionnellement un job ou un step Ã  l'aide du mot clÃ© `if` (link:https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idstepsif[documentation de `if`,window="_blank"])

[source,yaml]
----
jobs:
  release:
    steps:
      # Lance le step dire coucou uniquement si la branche est main.
      - name: "Dire Coucou"
        run: echo "coucou"
        if: contains('refs/heads/main', github.ref)
----

== ğŸ“ Secret GitHub / DockerHub Token

* Reprenez (ou recrÃ©ez) votre token DockerHub
** ğŸ’¡ https://docs.docker.com/docker-hub/access-tokens/[Documentation "Manage access tokens",window="_blank"]

* InsÃ©rez le token DockerHub comme secret dans votre dÃ©pÃ´t GitHub
** ğŸ’¡ https://docs.github.com/en/actions/security-guides/encrypted-secrets#creating-encrypted-secrets-for-a-repository[Creating encrypted secrets for a repository,window="_blank"]

== ğŸ“ Livraison Continue sur le DockerHub

* *But :* Automatiser le dÃ©ploiement de l'image dans le DockerHub lorsqu'un tag est poussÃ©

* Changez votre workflow de CI de faÃ§on Ã  ce que, sur un push de tag, les tÃ¢ches suivantes soient effectuÃ©es :
** Comme avant:  Build, Tests, Build Package
** SI c'est un tag, alors il faut pousser (et Ã©ventuellement reconstruire avec le bon nom) l'image sur le DockerHub

* ğŸ’¡ Il va falloir adapter `make release` pour qu'il ne pousse plus de tag
* ğŸ’¡ Utilisez les GitHub Action suivantes :
** https://github.com/marketplace/actions/docker-login[docker-login, window="_blank]

== âœ… Livraison Continue sur le DockerHub

[source,yml]
----
include::../code-samples/gh-actions/ci-docker-push-tag.yml[]
----

== DÃ©ploiement Continu

ğŸ‡¬ğŸ‡§ Continuous Deployment / "CD"

== ğŸ¤” Qu'est ce que le DÃ©ploiement Continu ?

* Version "avancÃ©e" de la livraison continue:
** Chaque changement *est* dÃ©ployÃ© en production, de maniÃ¨re *automatique*

== Continuous Delivery versus Deployment

image::continuous-depl-vs-delivery.jpg[caption=Continuous Delivery vs Deployment,width=700]

[.small]
Source : http://blog.crisp.se/2013/02/05/yassalsundman/continuous-delivery-vs-continuous-deployment

== BÃ©nÃ©fices du DÃ©ploiement Continu

* Rends triviale les procÃ©dures de mise en production et de rollback
** Encourage Ã  mettre en production le plus souvent possible
** Encourage Ã  faire des mises en production incrÃ©mentales
* Limite les risques d'erreur lors de la mise en production
* Fonctionne de 1 Ã  1000 serveurs et plus encore...

== ğŸ“ DÃ©ploiement Continu sur le DockerHub

* *But :* DÃ©ployer votre image `vehicle-server` continuellement sur le DockerHub

* Changez votre workflow de CI de faÃ§on Ã  ce que, sur un push sur la branch `main`, les tÃ¢ches suivantes soient effectuÃ©es :
** Comme avant: on joue le cycle de vie via make.
** SI c'est la branche `main`, alors il faut pousser l'image avec le tag `main` sur le DockerHub
** Conservez les autre cas avec les tags

== âœ… DÃ©ploiement Continu sur le DockerHub

[source,bash]
----
include::../code-samples/gh-actions/ci-docker-push-main.yml[]
----

== Checkpoint ğŸ¯

* La livraison continue et le dÃ©ploiement continu Ã©tendent les concepts du CI

* Les 2 sont automatisÃ©es, mais un Ãªtre humain est nÃ©cessaire comme dÃ©clencheur pour la 1Ã¨re

* Le choix dÃ©pends des risques et de la "production"

* On a vu comment automatiser le dÃ©ploiement dans GitHub Actions
** Conditions dans le workflow
** Gestion de secrets
